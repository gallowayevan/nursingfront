{
  "version": 3,
  "file": "bundle.css",
  "sources": [
    "..\\..\\src\\LineChart.svelte",
    "..\\..\\src\\LineChartDifference.svelte",
    "..\\..\\src\\SettingTable.svelte",
    "..\\..\\src\\TutorialModal.svelte",
    "..\\..\\src\\IntroBlock.svelte",
    "..\\..\\src\\CardButton.svelte",
    "..\\..\\src\\TableLegend.svelte",
    "..\\..\\src\\MapTable.svelte",
    "..\\..\\src\\RowChart.svelte",
    "..\\..\\src\\InfoBox.svelte"
  ],
  "sourcesContent": [
    "<script>\r\n  import Line from \"./Line.svelte\";\r\n  import LineChartLegend from \"./LineChartLegend.svelte\";\r\n  import { scaleLinear } from \"d3-scale\";\r\n  import { extent, max, group, mean, descending } from \"d3-array\";\r\n  import { line as d3line, area as d3area, curveMonotoneX } from \"d3-shape\";\r\n  import XTick from \"./XTick.svelte\";\r\n  import YTick from \"./YTick.svelte\";\r\n  import { fade } from \"svelte/transition\";\r\n  import \"array-flat-polyfill\";\r\n  import { numberFormat } from \"./utilities.js\";\r\n\r\n  export let data;\r\n  export let projectionStartYear;\r\n\r\n  const width = 800;\r\n  const height = 475;\r\n  const margin = { top: 20, right: 60, bottom: 65, left: 90 };\r\n  const colors = [\r\n    \"#1f77b4\",\r\n    \"#ff7f0e\",\r\n    \"#2ca02c\",\r\n    \"#d62728\",\r\n    \"#9467bd\",\r\n    \"#8c564b\",\r\n    \"#e377c2\",\r\n    \"#7f7f7f\",\r\n    \"#bcbd22\",\r\n    \"#17becf\"\r\n  ];\r\n\r\n  let colorMap = new Map();\r\n\r\n  //Could this be cleaner?\r\n  $: {\r\n    //Remove unused colors\r\n    colorMap.forEach(function(value, key) {\r\n      if (!data.map(d => d.id).includes(+key)) {\r\n        colorMap.delete(key);\r\n      }\r\n    });\r\n\r\n    //Assign color to new data\r\n    data.forEach(function(d) {\r\n      if (!colorMap.has(d.id)) {\r\n        const availableColors = colors.filter(\r\n          d => !Array.from(colorMap.values()).includes(d)\r\n        );\r\n        colorMap.set(d.id, availableColors[0]);\r\n      }\r\n    });\r\n  }\r\n\r\n  const transitionDuration = 400;\r\n\r\n  //Shape generators\r\n  $: line = d3line()\r\n    .curve(curveMonotoneX)\r\n    .defined(d => !isNaN(d.value))\r\n    .x(d => x(d.year))\r\n    .y(d => y(d.value));\r\n\r\n  $: area = d3area()\r\n    .x(d => x(d.year))\r\n    .y0(d => y(d.uci))\r\n    .y1(d => y(d.lci))\r\n    .curve(curveMonotoneX);\r\n  $: console.log(flatData);\r\n  //Scale\r\n  $: flatData = data\r\n    .map(d =>\r\n      d.values.map(e =>\r\n        Object.assign(\r\n          {\r\n            id: d.id,\r\n            rateOrTotal: d.params.find(d => d[0] == \"rateOrTotal\")[1]\r\n          },\r\n          e\r\n        )\r\n      )\r\n    )\r\n    .flat();\r\n  $: byYearData = group(flatData, d => d.year);\r\n  $: xExtent =\r\n    flatData.length > 0 ? extent(flatData, d => d.year) : [2015, 2032];\r\n  $: xHalfway = Math.round((xExtent[1] - xExtent[0]) / 2 + xExtent[0]);\r\n  $: yMax = flatData.length > 0 ? max(flatData, d => d.value) : 50;\r\n  $: x = scaleLinear()\r\n    .domain(xExtent)\r\n    .range([margin.left, width - margin.right]);\r\n  $: xTicks = x.ticks();\r\n  $: y = scaleLinear()\r\n    .domain([0, yMax])\r\n    .nice()\r\n    .range([height - margin.bottom, margin.top]);\r\n  $: yTicks = y.ticks();\r\n\r\n  let hoverData;\r\n  let lineChartPosition = [];\r\n  function handleHover(e) {\r\n    let hoverYear = Math.round(x.invert(getContainerCoords(this, e)[0]));\r\n    const boundingRect = e.target.getBoundingClientRect();\r\n    const scaling = boundingRect.width / width;\r\n    lineChartPosition = {\r\n      x: boundingRect.left,\r\n      y: boundingRect.top,\r\n      scaling: scaling\r\n    };\r\n    if (hoverYear < xExtent[0]) {\r\n      hoverYear = xExtent[0];\r\n    } else if (hoverYear > xExtent[1]) {\r\n      hoverYear = xExtent[1];\r\n    }\r\n    hoverData = {\r\n      year: hoverYear,\r\n      values: byYearData.get(hoverYear).sort(function(a, b) {\r\n        return descending(a, b);\r\n      })\r\n    };\r\n  }\r\n\r\n  function handleMouseLeave() {\r\n    hoverData = undefined;\r\n  }\r\n\r\n  function getContainerCoords(node, event) {\r\n    //From d3\r\n    //https://github.com/d3/d3-selection/blob/master/src/point.js\r\n\r\n    var svg = node.ownerSVGElement || node;\r\n\r\n    if (svg.createSVGPoint) {\r\n      var point = svg.createSVGPoint();\r\n      (point.x = event.clientX), (point.y = event.clientY);\r\n      point = point.matrixTransform(node.getScreenCTM().inverse());\r\n      return [point.x, point.y];\r\n    }\r\n\r\n    var rect = node.getBoundingClientRect();\r\n    return [\r\n      event.clientX - rect.left - node.clientLeft,\r\n      event.clientY - rect.top - node.clientTop\r\n    ];\r\n  }\r\n</script>\r\n\r\n<style>\r\n  .xAxis {\r\n    text-anchor: middle;\r\n  }\r\n\r\n  .yAxis {\r\n    text-anchor: end;\r\n  }\r\n\r\n  text {\r\n    /* has-text-grey-dark */\r\n    fill: hsl(0, 0%, 29%);\r\n  }\r\n</style>\r\n\r\n<div id=\"line-chart-div\">\r\n  {#if data.length > 0}\r\n    <h1 class=\"title\">Projection of Nurse Workforce</h1>\r\n    <h2 class=\"subtitle\">North Carolina, {xExtent[0]} - {xExtent[1]}</h2>\r\n    <svg id=\"line-chart-svg\" viewBox=\"0 0 {width} {height}\">\r\n      <g class=\"chart-container\">\r\n        <rect\r\n          width={width - margin.right - x(projectionStartYear - 1)}\r\n          x={x(projectionStartYear - 1)}\r\n          y={margin.top}\r\n          height={height - margin.bottom - margin.top}\r\n          fill=\"#ececec\" />\r\n        <text\r\n          class=\"is-size-5\"\r\n          transform=\"translate({x(projectionStartYear - 1)},{margin.top - 5})\">\r\n          Projected\r\n        </text>\r\n        <g\r\n          class=\"xAxis is-size-6\"\r\n          transform=\"translate(0,{height - margin.bottom})\">\r\n          {#each xTicks as tick (tick)}\r\n            <XTick\r\n              position={[x(tick), 0]}\r\n              value={tick}\r\n              duration={transitionDuration} />\r\n          {/each}\r\n        </g>\r\n        <g class=\"yAxis is-size-6\" transform=\"translate({margin.left},0)\">\r\n          {#each yTicks as tick (tick)}\r\n            <YTick\r\n              {y}\r\n              value={tick}\r\n              duration={transitionDuration}\r\n              chartWidth={width - margin.right - margin.left} />\r\n          {/each}\r\n        </g>\r\n        {#each data as lineElement (lineElement.id)}\r\n          <Line\r\n            areaPath={area(lineElement.values)}\r\n            linePath={line(lineElement.values)}\r\n            color={colorMap.get(lineElement.id)}\r\n            duration={transitionDuration} />\r\n        {/each}\r\n        <text\r\n          class=\"is-size-5\"\r\n          transform=\"translate({margin.left - 70},{height / 1.5}) rotate(270)\">\r\n          Nurse FTE or Head Count\r\n        </text>\r\n        <text\r\n          class=\"is-size-5\"\r\n          text-anchor=\"middle\"\r\n          transform=\"translate({(width - margin.left - margin.right) / 2 + margin.left},{height - 10})\">\r\n          Year\r\n        </text>\r\n        {#if hoverData && data.length > 0}\r\n          <line\r\n            x1={x(hoverData.year)}\r\n            x2={x(hoverData.year)}\r\n            y1={margin.top}\r\n            y2={height - margin.bottom}\r\n            stroke=\"#333\"\r\n            stroke-width=\"2\" />\r\n          {#each hoverData.values as row}\r\n            <g transform=\"translate({x(hoverData.year)} {y(row.value)})\">\r\n              <circle cx=\"0\" cy=\"0\" r=\"5\" stroke=\"#333\" fill=\"none\" />\r\n            </g>\r\n          {/each}\r\n        {/if}\r\n        <rect\r\n          {width}\r\n          {height}\r\n          fill=\"none\"\r\n          on:mousemove={handleHover}\r\n          on:mouseleave={handleMouseLeave}\r\n          style=\"pointer-events:all;\" />\r\n      </g>\r\n    </svg>\r\n    {#if hoverData}\r\n      <div\r\n        style=\"position:fixed; top:{lineChartPosition.y + lineChartPosition.scaling * y(mean(hoverData.values, d => d.value))}px;\r\n        left:{lineChartPosition.x + lineChartPosition.scaling * (x(hoverData.year) + 8)}px;\r\n        background: rgba(255, 255, 255, 0.9); border-radius:5px;border: 1px\r\n        solid #333333;padding:3px 3px;z-index:200;font-weight:600;\">\r\n        {#each hoverData.values as row}\r\n          <div style=\"color:{colorMap.get(row.id)}\">\r\n            {numberFormat(row.rateOrTotal)(row.value)}\r\n          </div>\r\n        {/each}\r\n      </div>\r\n    {/if}\r\n  {:else}\r\n    <div class=\"notification\">Select model options and click \"Show\".</div>\r\n  {/if}\r\n  <LineChartLegend\r\n    on:deleteProjection\r\n    legendData={data.map((d, i) => ({\r\n      params: d.params,\r\n      color: colorMap.get(d.id),\r\n      id: d.id\r\n    }))} />\r\n</div>\r\n",
    "<script>\r\n  import Line from \"./Line.svelte\";\r\n  import LineChartLegend from \"./LineChartLegend.svelte\";\r\n  import { scaleLinear } from \"d3-scale\";\r\n  import { extent, max, group, descending, mean } from \"d3-array\";\r\n  import { line as d3line, area as d3area, curveMonotoneX } from \"d3-shape\";\r\n  import XTick from \"./XTick.svelte\";\r\n  import YTick from \"./YTick.svelte\";\r\n  import { fade } from \"svelte/transition\";\r\n  import \"array-flat-polyfill\";\r\n  import { numberFormat } from \"./utilities.js\";\r\n\r\n  export let data;\r\n  export let projectionStartYear;\r\n\r\n  const width = 800;\r\n  const height = 475;\r\n  const margin = { top: 20, right: 60, bottom: 65, left: 90 };\r\n  const colors = [\r\n    \"#1f77b4\",\r\n    \"#ff7f0e\",\r\n    \"#2ca02c\",\r\n    \"#d62728\",\r\n    \"#9467bd\",\r\n    \"#8c564b\",\r\n    \"#e377c2\",\r\n    \"#7f7f7f\",\r\n    \"#bcbd22\",\r\n    \"#17becf\"\r\n  ];\r\n\r\n  let colorMap = new Map();\r\n\r\n  //Could this be cleaner?\r\n  $: {\r\n    //Remove unused colors\r\n    colorMap.forEach(function(value, key) {\r\n      if (!data.map(d => d.id).includes(+key)) {\r\n        colorMap.delete(key);\r\n      }\r\n    });\r\n\r\n    //Assign color to new data\r\n    data.forEach(function(d) {\r\n      if (!colorMap.has(d.id)) {\r\n        const availableColors = colors.filter(\r\n          d => !Array.from(colorMap.values()).includes(d)\r\n        );\r\n        colorMap.set(d.id, availableColors[0]);\r\n      }\r\n    });\r\n  }\r\n\r\n  const transitionDuration = 400;\r\n\r\n  const curve = curveMonotoneX;\r\n\r\n  //Shape generators\r\n  $: line = d3line()\r\n    .curve(curve)\r\n    .defined(d => !isNaN(d.value))\r\n    .x(d => x(d.year))\r\n    .y(d => y(d.value));\r\n\r\n  $: aboveClip = d3area()\r\n    .x(d => x(d.year))\r\n    .y0(0)\r\n    .y1(d => y(d.value))\r\n    .curve(curve);\r\n\r\n  $: belowClip = d3area()\r\n    .x(d => x(d.year))\r\n    .y0(height)\r\n    .y1(d => y(d.value))\r\n    .curve(curve);\r\n\r\n  $: aboveArea = d3area()\r\n    .curve(curve)\r\n    .x(d => x(d.year))\r\n    .y0(d => y(d.min))\r\n    .y1(d => y(d.value));\r\n\r\n  $: belowArea = d3area()\r\n    .curve(curve)\r\n    .x(d => x(d.year))\r\n    .y0(d => y(d.max))\r\n    .y1(d => y(d.value));\r\n\r\n  //clipAbove and clipBelow generators\r\n  //Then use clip component to create clipPaths and\r\n  //https://observablehq.com/@d3/difference-chart\r\n\r\n  $: flatData = data\r\n    .map(d =>\r\n      d.values.map(e =>\r\n        Object.assign(\r\n          {\r\n            id: d.id,\r\n            rateOrTotal: d.params.find(d => d[0] == \"rateOrTotal\")[1]\r\n          },\r\n          e\r\n        )\r\n      )\r\n    )\r\n    .flat();\r\n  $: byYearData = group(flatData, d => d.year);\r\n  $: xExtent =\r\n    flatData.length > 0 ? extent(flatData, d => d.year) : [2015, 2032];\r\n  $: xHalfway = Math.round((xExtent[1] - xExtent[0]) / 2 + xExtent[0]);\r\n  $: yMax =\r\n    flatData.length > 0\r\n      ? max(flatData.flatMap(d => [d.supplyMean, d.demandMean]))\r\n      : 50;\r\n  $: x = scaleLinear()\r\n    .domain(xExtent)\r\n    .range([margin.left, width - margin.right]);\r\n  $: xTicks = x.ticks();\r\n  $: y = scaleLinear()\r\n    .domain([0, yMax])\r\n    .nice()\r\n    .range([height - margin.bottom, margin.top]);\r\n  $: yTicks = y.ticks();\r\n\r\n  let hoverData;\r\n  let lineChartPosition = [];\r\n  function handleHover(e) {\r\n    let hoverYear = Math.round(x.invert(getContainerCoords(this, e)[0]));\r\n    const boundingRect = e.target.getBoundingClientRect();\r\n    const scaling = boundingRect.width / width;\r\n    lineChartPosition = {\r\n      x: boundingRect.left,\r\n      y: boundingRect.top,\r\n      scaling: scaling\r\n    };\r\n    if (hoverYear < xExtent[0]) {\r\n      hoverYear = xExtent[0];\r\n    } else if (hoverYear > xExtent[1]) {\r\n      hoverYear = xExtent[1];\r\n    }\r\n    hoverData = {\r\n      year: hoverYear,\r\n      values: byYearData.get(hoverYear).sort(function(a, b) {\r\n        return descending(\r\n          mean([a.supplyMean, a.demandMean]),\r\n          mean([b.supplyMean, b.demandMean])\r\n        );\r\n      })\r\n    };\r\n  }\r\n\r\n  function handleMouseLeave() {\r\n    hoverData = undefined;\r\n  }\r\n\r\n  function getTooltipText({ supplyMean, demandMean, rateOrTotal }) {\r\n    const currentNumberFormat = numberFormat(rateOrTotal);\r\n    return [\r\n      {\r\n        type: \"supply\",\r\n        value: supplyMean,\r\n        text: `Supply: ${currentNumberFormat(supplyMean)}`\r\n      },\r\n      {\r\n        type: \"demand\",\r\n        value: demandMean,\r\n        text: `Demand: ${currentNumberFormat(demandMean)}`\r\n      }\r\n    ]\r\n      .sort((a, b) => descending(a.value, b.value))\r\n      .map(d => d.text)\r\n      .join(\"<br>\");\r\n  }\r\n\r\n  function addExtentToValues(values) {\r\n    const [min, max] = extent(\r\n      values.flatMap(d => [d.supplyMean, d.demandMean])\r\n    );\r\n    return values.map(d => Object.assign({ min, max }, d));\r\n  }\r\n\r\n  function getContainerCoords(node, event) {\r\n    //From d3\r\n    //https://github.com/d3/d3-selection/blob/master/src/point.js\r\n\r\n    var svg = node.ownerSVGElement || node;\r\n\r\n    if (svg.createSVGPoint) {\r\n      var point = svg.createSVGPoint();\r\n      (point.x = event.clientX), (point.y = event.clientY);\r\n      point = point.matrixTransform(node.getScreenCTM().inverse());\r\n      return [point.x, point.y];\r\n    }\r\n\r\n    var rect = node.getBoundingClientRect();\r\n    return [\r\n      event.clientX - rect.left - node.clientLeft,\r\n      event.clientY - rect.top - node.clientTop\r\n    ];\r\n  }\r\n</script>\r\n\r\n<style>\r\n  .xAxis {\r\n    text-anchor: middle;\r\n  }\r\n\r\n  .yAxis {\r\n    text-anchor: end;\r\n  }\r\n\r\n  text {\r\n    /* has-text-grey-dark */\r\n    fill: hsl(0, 0%, 29%);\r\n  }\r\n</style>\r\n\r\n<div id=\"line-chart-div\">\r\n  {#if data.length > 0}\r\n    <h1 class=\"title\">Projection of Nurse Workforce</h1>\r\n    <h2 class=\"subtitle\">North Carolina, {xExtent[0]} - {xExtent[1]}</h2>\r\n    <svg id=\"line-chart-svg\" viewBox=\"0 0 {width} {height}\">\r\n      <defs>\r\n        {#each data as gradient (gradient.id)}\r\n          <linearGradient\r\n            id={'gradientBelow' + gradient.id}\r\n            x1=\"0%\"\r\n            y1=\"0%\"\r\n            x2=\"0%\"\r\n            y2=\"100%\">\r\n            <stop\r\n              offset=\"0%\"\r\n              stop-color={colorMap.get(gradient.id)}\r\n              stop-opacity=\"1\" />\r\n            <stop offset=\"100%\" stop-color=\"white\" stop-opacity=\"0\" />\r\n          </linearGradient>\r\n          <linearGradient\r\n            id={'gradientAbove' + gradient.id}\r\n            x1=\"0%\"\r\n            y1=\"100%\"\r\n            x2=\"0%\"\r\n            y2=\"0%\">\r\n            <stop\r\n              offset=\"0%\"\r\n              stop-color={colorMap.get(gradient.id)}\r\n              stop-opacity=\"1\" />\r\n            <stop offset=\"100%\" stop-color=\"white\" stop-opacity=\"0\" />\r\n          </linearGradient>\r\n        {/each}\r\n      </defs>\r\n      {#each data as clip (clip.id)}\r\n        <clipPath id={'above' + clip.id}>\r\n          <path\r\n            d={aboveClip(clip.values.map(({ year, demandMean }) => ({\r\n                year,\r\n                value: demandMean\r\n              })))} />\r\n        </clipPath>\r\n        <clipPath id={'below' + clip.id}>\r\n          <path\r\n            d={belowClip(clip.values.map(({ year, demandMean }) => ({\r\n                year,\r\n                value: demandMean\r\n              })))} />\r\n        </clipPath>\r\n      {/each}\r\n      <g class=\"chart-container\">\r\n        <rect\r\n          width={width - margin.right - x(projectionStartYear - 1)}\r\n          x={x(projectionStartYear - 1)}\r\n          y={margin.top}\r\n          height={height - margin.bottom - margin.top}\r\n          fill=\"#ececec\" />\r\n        <text\r\n          class=\"is-size-5\"\r\n          transform=\"translate({x(projectionStartYear - 1)},{margin.top - 5})\">\r\n          Projected\r\n        </text>\r\n        <g\r\n          class=\"xAxis is-size-6\"\r\n          transform=\"translate(0,{height - margin.bottom})\">\r\n          {#each xTicks as tick (tick)}\r\n            <XTick\r\n              position={[x(tick), 0]}\r\n              value={tick}\r\n              duration={transitionDuration} />\r\n          {/each}\r\n        </g>\r\n        <g class=\"yAxis is-size-6\" transform=\"translate({margin.left},0)\">\r\n          {#each yTicks as tick (tick)}\r\n            <YTick\r\n              {y}\r\n              value={tick}\r\n              duration={transitionDuration}\r\n              chartWidth={width - margin.right - margin.left} />\r\n          {/each}\r\n        </g>\r\n        {#each data as lineElement (lineElement.id)}\r\n          <Line\r\n            linePath={line(lineElement.values.map(({ year, supplyMean }) => ({\r\n                year,\r\n                value: supplyMean\r\n              })))}\r\n            color={colorMap.get(lineElement.id)}\r\n            duration={transitionDuration} />\r\n          <Line\r\n            linePath={line(lineElement.values.map(({ year, demandMean }) => ({\r\n                year,\r\n                value: demandMean\r\n              })))}\r\n            dashArray=\"4\"\r\n            color={colorMap.get(lineElement.id)}\r\n            duration={transitionDuration} />\r\n\r\n          <path\r\n            clip-path={`url(#above${lineElement.id})`}\r\n            fill={`url(#gradientBelow${lineElement.id})`}\r\n            d={aboveArea(addExtentToValues(lineElement.values).map(\r\n                ({ year, supplyMean, min, max }) => ({\r\n                  year,\r\n                  value: supplyMean,\r\n                  min,\r\n                  max\r\n                })\r\n              ))} />\r\n          <path\r\n            clip-path={`url(#below${lineElement.id})`}\r\n            fill={`url(#gradientAbove${lineElement.id})`}\r\n            d={belowArea(addExtentToValues(lineElement.values).map(\r\n                ({ year, supplyMean, min, max }) => ({\r\n                  year,\r\n                  value: supplyMean,\r\n                  min,\r\n                  max\r\n                })\r\n              ))} />\r\n          <!-- <path clip-path={`url(#below${lineElement.id})`}\r\n            d={aboveClip(lineElement.values.map(({ year, supplyMean }) => ({\r\n                year,\r\n                value: supplyMean\r\n              })))}\r\n            fill={`url(#gradientAbove${lineElement.id})`} /> -->\r\n          <!-- <path\r\n            d={belowClip(lineElement.values.map(({ year, supplyMean }) => ({\r\n                year,\r\n                value: supplyMean\r\n              })))}\r\n            fill={`url(#gradientBelow${lineElement.id})`} /> -->\r\n        {/each}\r\n        <text\r\n          class=\"is-size-5\"\r\n          transform=\"translate({margin.left - 70},{height / 1.5}) rotate(270)\">\r\n          Nurse FTE or Head Count\r\n        </text>\r\n        <text\r\n          class=\"is-size-5\"\r\n          text-anchor=\"middle\"\r\n          transform=\"translate({(width - margin.left - margin.right) / 2 + margin.left},{height - 10})\">\r\n          Year\r\n        </text>\r\n        {#if hoverData && data.length > 0}\r\n          <line\r\n            x1={x(hoverData.year)}\r\n            x2={x(hoverData.year)}\r\n            y1={margin.top}\r\n            y2={height - margin.bottom}\r\n            stroke=\"#333\"\r\n            stroke-width=\"2\" />\r\n          {#each hoverData.values as row}\r\n            <g transform=\"translate({x(hoverData.year)} {y(row.demandMean)})\">\r\n              <circle cx=\"0\" cy=\"0\" r=\"5\" stroke=\"#333\" fill=\"none\" />\r\n            </g>\r\n            <g transform=\"translate({x(hoverData.year)} {y(row.supplyMean)})\">\r\n              <circle cx=\"0\" cy=\"0\" r=\"5\" stroke=\"#333\" fill=\"none\" />\r\n            </g>\r\n          {/each}\r\n        {/if}\r\n        <rect\r\n          {width}\r\n          {height}\r\n          fill=\"none\"\r\n          on:mousemove={handleHover}\r\n          on:mouseleave={handleMouseLeave}\r\n          style=\"pointer-events:all;\" />\r\n      </g>\r\n\r\n    </svg>\r\n    {#if hoverData}\r\n      <div\r\n        style=\"position:fixed; top:{lineChartPosition.y + lineChartPosition.scaling * y(mean(hoverData.values\r\n                  .map(d => [d.supplyMean, d.demandMean])\r\n                  .reduce((acc, val) => acc.concat(val), [])))}px; left:{lineChartPosition.x + lineChartPosition.scaling * (x(hoverData.year) + 8)}px;\r\n        background: rgba(255, 255, 255, 0.9); border-radius:5px;border: 1px\r\n        solid #333333;padding:3px 3px;z-index:200;font-weight:600;\">\r\n\r\n        {#each hoverData.values as row}\r\n          <div style=\"color:{colorMap.get(row.id)}\">\r\n            {@html getTooltipText(row)}\r\n          </div>\r\n        {/each}\r\n      </div>\r\n    {/if}\r\n  {:else}\r\n    <div class=\"notification\">Select model options and click \"Show\".</div>\r\n  {/if}\r\n  <LineChartLegend\r\n    on:deleteProjection\r\n    legendData={data.map((d, i) => ({\r\n      params: d.params,\r\n      color: colorMap.get(d.id),\r\n      id: d.id\r\n    }))} />\r\n</div>\r\n",
    "<script>\r\n  import {\r\n    group,\r\n    extent,\r\n    ascending,\r\n    least,\r\n    max,\r\n    min,\r\n    permute,\r\n    mean\r\n  } from \"d3-array\";\r\n  import { scaleSymlog } from \"d3-scale\";\r\n  import { interpolateBlues, interpolateReds } from \"d3-scale-chromatic\";\r\n  import options from \"./data/options.js\";\r\n  import { fontColor, throttle, numberFormat } from \"./utilities.js\";\r\n  import \"array-flat-polyfill\";\r\n  import { onMount, onDestroy } from \"svelte\";\r\n  import TableLegend from \"./TableLegend.svelte\";\r\n\r\n  const settingNamesMap = new Map(\r\n    options.get(\"setting\").options.map(d => [d.value, d.label])\r\n  );\r\n  settingNamesMap.set(9, \"Other\");\r\n\r\n  const numberPerPage = 10;\r\n\r\n  export let data;\r\n  export let projectionStartYear;\r\n  export let showTitle = true;\r\n  let leftCoord = 0;\r\n\r\n  const frozenWidth = \"14em\";\r\n\r\n  let currentPage = 0;\r\n  //Reset counter when data changes\r\n  $: if (data) {\r\n    currentPage = 0;\r\n  }\r\n\r\n  $: params = data.params\r\n    ? data.params.reduce((acc, curr) => {\r\n        acc[curr[0]] = options\r\n          .get(curr[0])\r\n          .options.find(d => d.value == curr[1]).label;\r\n        return acc;\r\n      }, {})\r\n    : {};\r\n\r\n  $: calculation = data.params.find(d => d[0] == \"calculation\")[1];\r\n\r\n  $: currentNumberFormat = numberFormat(\r\n    +data.params.find(d => d[0] == \"rateOrTotal\")[1]\r\n  );\r\n\r\n  //change to also take into account calculation\r\n\r\n  $: baseYear = 2018; //min(data.values, e => e.year);\r\n\r\n  $: grouped = Array.from(group(data.values, d => d.setting))\r\n    .map(function(d) {\r\n      const baseValue = d[1].find(e => e.year == baseYear).value;\r\n      const calculationDifferenceRatio =\r\n        (calculation == \"difference\") | (calculation == \"ratio\");\r\n      const valueArray = d[1].map(function(e) {\r\n        const change = calculationDifferenceRatio\r\n          ? e.value\r\n          : e.value / baseValue;\r\n        return Object.assign({ change: change }, e);\r\n      });\r\n      return [\r\n        settingNamesMap.get(d[0]) || d[0],\r\n        valueArray.sort((a, b) => ascending(a.year, b.year))\r\n      ];\r\n    })\r\n    .sort((a, b) => ascending(a[0], b[0]));\r\n\r\n  $: flatChangeValues = grouped.flatMap(d => d[1]).map(d => d.change);\r\n  $: maxChange =\r\n    (calculation == \"difference\") | (calculation == \"ratio\")\r\n      ? max(flatChangeValues, d => Math.abs(d))\r\n      : Math.max(\r\n          max(flatChangeValues, d => (d == 0 ? 0 : 1 / d)),\r\n          max(flatChangeValues, d => d / 1)\r\n        );\r\n\r\n  // $: maxChange = max(flatChangeValues, d => Math.abs(d));\r\n  // $: meanChange = mean(flatChangeValues);\r\n  $: domain =\r\n    calculation == \"difference\"\r\n      ? [-maxChange, 0, maxChange]\r\n      : [1 / maxChange, 1, maxChange];\r\n  $: colorScale = scaleSymlog()\r\n    .domain(domain)\r\n    .range([-1, 0, 1])\r\n    .interpolate((a, b) =>\r\n      a < 0 ? t => interpolateReds(1 - t) : t => interpolateBlues(t)\r\n    );\r\n\r\n  // $: colorScale = scaleLinear().domain(-maxChange);\r\n\r\n  $: numOfPages = Math.ceil(grouped.length / numberPerPage);\r\n  $: paged = group(grouped, (d, i) => Math.floor(i / numberPerPage));\r\n  $: currentRows = paged.get(currentPage);\r\n\r\n  function jumpToPage(e) {\r\n    currentPage = +e.target.innerText - 1;\r\n  }\r\n\r\n  function calculatePosition() {\r\n    const { left: containerLeft } = document\r\n      .getElementById(\"main-container\")\r\n      .getBoundingClientRect();\r\n    const { left: tableLeft } = document\r\n      .getElementById(\"top-level-table-div\")\r\n      .getBoundingClientRect();\r\n\r\n    leftCoord = tableLeft - containerLeft;\r\n  }\r\n\r\n  onMount(() => {\r\n    calculatePosition();\r\n    window.onresize = throttle(calculatePosition, 100);\r\n  });\r\n\r\n  onDestroy(() => {\r\n    window.onresize = null;\r\n  });\r\n</script>\r\n\r\n<style>\r\n  #wrapper {\r\n    overflow-x: scroll;\r\n    /* margin-left: 10em; */\r\n    overflow-y: visible;\r\n    padding: 0;\r\n  }\r\n\r\n  .frozen {\r\n    white-space: nowrap;\r\n    position: absolute;\r\n    /* width: 10em; */\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n  }\r\n\r\n  .projection {\r\n    border-top: 3px;\r\n    border-top-color: #6c7480;\r\n    border-top-style: solid;\r\n  }\r\n\r\n  .projection-header {\r\n    border-bottom-style: none;\r\n    font-size: 0.6em;\r\n  }\r\n\r\n  .number-cell {\r\n    text-align: right;\r\n  }\r\n</style>\r\n\r\n{#if data.values}\r\n  <div id=\"top-level-table-div\">\r\n    {#if showTitle}\r\n      <h1 class=\"title is-4\">{params['type']}s by Setting, North Carolina</h1>\r\n      <h2 class=\"subtitle is-6\">\r\n        {permute(params, [\r\n          ...data.params.filter(d => d[0].includes('Scenario')).map(d => d[0]),\r\n          'location',\r\n          'education',\r\n          'fteOrHeadcount',\r\n          'rateOrTotal',\r\n          'calculation'\r\n        ]).join(', ')}\r\n      </h2>\r\n    {/if}\r\n    <TableLegend {baseYear} />\r\n\r\n    <div\r\n      class=\"table-container\"\r\n      id=\"wrapper\"\r\n      style=\"margin-left:{frozenWidth};\">\r\n      <table class=\"table is-narrow\">\r\n        <thead>\r\n          <tr>\r\n            <th\r\n              class=\" frozen projection-header\"\r\n              style=\"width:{frozenWidth};\" />\r\n            {#each grouped[0][1] as year}\r\n              <th class=\"projection-header\" style=\"padding:0;\">\r\n                {year.year == projectionStartYear ? 'Projected' : ''}\r\n              </th>\r\n            {/each}\r\n          </tr>\r\n          <tr>\r\n            <th\r\n              class=\"frozen\"\r\n              style=\"left:{leftCoord}px;padding-bottom:5px;width:{frozenWidth};\">\r\n              Setting\r\n            </th>\r\n            {#each grouped[0][1] as year}\r\n              <th class:projection={year.year >= projectionStartYear}>\r\n                {year.year}\r\n              </th>\r\n            {/each}\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {#each currentRows as row, index}\r\n            <tr>\r\n              <!-- This padding adjustment (along with the one in the thead) are to correct for some mysterious\r\n            misalignment of the borders for the first two elements in the first column. -->\r\n              <td\r\n                class=\"frozen\"\r\n                title={row[0]}\r\n                style=\"width:{frozenWidth};left:{leftCoord}px;{index == 0 ? `padding-bottom:5px;` : ''}\">\r\n                {row[0]}\r\n              </td>\r\n              {#each row[1] as cell, index}\r\n                <td\r\n                  class=\"number-cell\"\r\n                  style=\"background-color:{colorScale(cell.change)}; color:{fontColor(colorScale(cell.change))};\">\r\n                  {currentNumberFormat(cell.value)}\r\n                </td>\r\n              {/each}\r\n            </tr>\r\n          {/each}\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n    {#if numOfPages > 1}\r\n      <nav class=\"pagination\" role=\"navigation\" aria-label=\"pagination\">\r\n        <ul class=\"pagination-list\">\r\n          {#each Array.from({ length: numOfPages }, (_, i) => i + 1) as pageNum}\r\n            <li>\r\n              <button\r\n                class=\"pagination-link {currentPage + 1 == pageNum ? 'is-current' : ''}\"\r\n                on:click={jumpToPage}\r\n                aria-label=\"Goto page {pageNum}\">\r\n                {pageNum}\r\n              </button>\r\n            </li>\r\n          {/each}\r\n        </ul>\r\n      </nav>\r\n    {/if}\r\n  </div>\r\n{:else}\r\n  <div class=\"notification\">\r\n    Choose a combination of selections and click \"Show\" to see a table of the\r\n    model's projections.\r\n  </div>\r\n{/if}\r\n",
    "<script>\r\n  import TutorialImage from \"./TutorialImage.svelte\";\r\n  export let showModal;\r\n\r\n  const images = [\r\n    \"Selectcharttype 500px.png\",\r\n    \"Modify chart 500px.png\",\r\n    \"Linechart guide 500px.png\",\r\n    \"clearviz 500px.png\",\r\n    \"MapGuide 500px.png\",\r\n    \"Table PNG plain.png\"\r\n  ];\r\n</script>\r\n\r\n<style>\r\n  .is-family-code {\r\n    font-weight: bolder;\r\n    background-color: #ececec;\r\n  }\r\n</style>\r\n\r\n<div class=\"modal\" class:is-active={showModal}>\r\n  <div class=\"modal-background\" on:click />\r\n  <div class=\"modal-card\">\r\n    <header class=\"modal-card-head\">\r\n      <p class=\"modal-card-title\">User Guide</p>\r\n      <button\r\n        class=\"delete\"\r\n        aria-label=\"close\"\r\n        data-bulma-modal=\"close\"\r\n        on:click />\r\n    </header>\r\n    <section class=\"modal-card-body content\">\r\n      <h1 class=\"title\">Viewing Nurse Workforce Projections</h1>\r\n      <TutorialImage imageFileName={images[0]}>\r\n        <p>\r\n          <span class=\"has-text-weight-semibold\">\r\n            Select whether you would like to view the data as a line chart, map\r\n            or table.\r\n          </span>\r\n        </p>\r\n      </TutorialImage>\r\n      <TutorialImage imageFileName={images[1]}>\r\n        <p>\r\n          <span class=\"has-text-weight-semibold\">\r\n            Use the radio buttons to choose the parameters for the projection\r\n            you would like to view.\r\n          </span>\r\n          Select the\r\n          <span class=\"is-family-code\">i</span>\r\n          icon to learn more about each option. Then, select\r\n          <span class=\"is-family-code\">Show</span>\r\n          to display the line chart, map or table.\r\n        </p>\r\n      </TutorialImage>\r\n      <TutorialImage imageFileName={images[2]}>\r\n\r\n        <h2>Using the line chart function</h2>\r\n        <p>\r\n          <span class=\"has-text-weight-semibold\">\r\n            If you are using the line chart option,\r\n          </span>\r\n          you can display multiple lines at once to compare. Just change your\r\n          options and select\r\n          <span class=\"is-family-code\">Show</span>\r\n          again. To remove a line, hit the\r\n          <span class=\"is-family-code\">X</span>\r\n          button in the top left of its corresponding box. Once you have\r\n          displayed the projections* you are interested in, you can download the\r\n          image (as a PNG) or the data (as a CSV file).\r\n        </p>\r\n        <p>\r\n          <span class=\"has-text-weight-semibold\">Please note:</span>\r\n          the model won’t allow you to display the projections for specific\r\n          education categories combined with specific settings at the same time.\r\n          For instance, the projection for RN, with BS for education, and\r\n          hospital for setting is not available. This is because the numbers are\r\n          small.\r\n        </p>\r\n        <p>\r\n          *The projection line does include some historical data, but\r\n          projections are delineated by gray.\r\n        </p>\r\n      </TutorialImage>\r\n      <TutorialImage imageFileName={images[3]}>\r\n        <p>\r\n          <span class=\"has-text-weight-semibold\">\r\n            To remove all lines and reset the visualization, select the\r\n            <span class=\"is-family-code\">Clear</span>\r\n            button.\r\n          </span>\r\n        </p>\r\n      </TutorialImage>\r\n      <TutorialImage imageFileName={images[4]}>\r\n        <h2>Using the map function</h2>\r\n        <p>\r\n          <span class=\"has-text-weight-semibold\">\r\n            You can also view projections as a map.\r\n          </span>\r\n          Use the slider below the map to change the year of data. The maps are\r\n          color-coded to indicate the location of each area.\r\n        </p>\r\n      </TutorialImage>\r\n      <TutorialImage imageFileName={images[5]}>\r\n        <h2>Using the table option</h2>\r\n        <p>\r\n          <span class=\"has-text-weight-semibold\">\r\n            You can also view projections in a table.\r\n          </span>\r\n          The colors represent the change relative to the baseline (the first\r\n          year, in this case, 2008).\r\n          <span style=\"color:red;\">Red</span>\r\n          indicates a decrease from the baseline.\r\n          <span style=\"color:blue;\">Blue</span>\r\n          indicates an increase from the baseline. The table can be downloaded\r\n          as a CSV file.\r\n        </p>\r\n      </TutorialImage>\r\n\r\n    </section>\r\n  </div>\r\n</div>\r\n",
    "<script>\r\n  import { createEventDispatcher } from \"svelte\";\r\n\r\n  const dispatch = createEventDispatcher();\r\n\r\n  export let chartType;\r\n\r\n  function handleLaunchTutorial() {\r\n    dispatch(\"launchTutorial\");\r\n  }\r\n</script>\r\n\r\n<style>\r\n  div {\r\n    height: 100%;\r\n    padding: 1rem;\r\n    border-radius: 6px;\r\n  }\r\n</style>\r\n\r\n<div class=\"content has-background-light\">\r\n\r\n  {#if chartType == 'line'}\r\n    <h2>You can create a line chart.</h2>\r\n    <p>\r\n      <span class=\"has-text-weight-semibold\">\r\n        If you are using the line chart option,\r\n      </span>\r\n      you can display multiple lines at once to compare. Just change your\r\n      options and select\r\n      <span class=\"is-family-code\">Show</span>\r\n      again. To remove a line, hit the\r\n      <span class=\"is-family-code\">X</span>\r\n      button in the top left of its corresponding box. Once you have displayed\r\n      the projections* you are interested in, you can download the image (as a\r\n      PNG) or the data (as a CSV file).\r\n    </p>\r\n    <img\r\n      class=\"image\"\r\n      alt=\"How to use the line chart.\"\r\n      src=\"public/images/tutorial/03_line_chart.png\" />\r\n    <hr />\r\n    <p>\r\n      <span class=\"has-text-weight-semibold\">Please note:</span>\r\n      the model won’t allow you to display the projections for specific\r\n      education categories combined with specific settings at the same time. For\r\n      instance, the projection for RN, with BS for education, and hospital for\r\n      setting is not available. This is because the numbers are small.\r\n    </p>\r\n    <p>\r\n      *The projection line does include some historical data, but projections\r\n      are delineated by gray.\r\n    </p>\r\n  {:else if chartType == 'map'}\r\n    <h2>You can create a map.</h2>\r\n    <p>\r\n      <span class=\"has-text-weight-semibold\">\r\n        You can also view projections as a map.\r\n      </span>\r\n      Use the slider below the map to change the year of data. The maps are\r\n      color-coded to indicate the location of each area.\r\n    </p>\r\n    <img\r\n      class=\"image\"\r\n      alt=\"How to use the map.\"\r\n      src=\"public/images/tutorial/05_map.png\" />\r\n  {:else if chartType == 'table'}\r\n    <h2>You can create a table.</h2>\r\n    <p>\r\n      <span class=\"has-text-weight-semibold\">\r\n        You can also view projections in a table.\r\n      </span>\r\n      The colors represent the change relative to the baseline (the first year,\r\n      in this case, 2008).\r\n      <span style=\"color:red;\">Red</span>\r\n      indicates a decrease from the baseline.\r\n      <span style=\"color:blue;\">Blue</span>\r\n      indicates an increase from the baseline. The table can be downloaded as a\r\n      CSV file.\r\n    </p>\r\n    <img\r\n      class=\"image\"\r\n      alt=\"How to use the table.\"\r\n      src=\"public/images/tutorial/06_table.png\" />\r\n  {:else}\r\n    <h2 class=\"subtitle is-size-5 has-text-grey-dark\">\r\n      Select a chart type and projection options, or launch our tutorial to\r\n      learn more!\r\n      <button\r\n        class=\"button is-primary is-outlined is-center is-rounded\"\r\n        id=\"btn\"\r\n        on:click={handleLaunchTutorial}>\r\n        Launch User Guide\r\n      </button>\r\n    </h2>\r\n  {/if}\r\n</div>\r\n",
    "<script>\r\n  import { createEventDispatcher } from \"svelte\";\r\n\r\n  const dispatch = createEventDispatcher();\r\n\r\n  export let calculation;\r\n  export let name;\r\n\r\n  $: active = calculation == name;\r\n</script>\r\n\r\n<style>\r\n  .card {\r\n    transition: box-shadow 0.3s;\r\n  }\r\n\r\n  .card:hover {\r\n    box-shadow: 0 0 11px rgba(70, 93, 128, 0.7);\r\n    z-index: 100;\r\n  }\r\n</style>\r\n\r\n<div\r\n  class=\"card column is-one-quarter\"\r\n  class:has-background-primary={active}\r\n  class:has-text-white={active}\r\n  on:click={() => dispatch('clicked', name)}>\r\n  <div class=\"card-content\">\r\n    <p class=\"is-size-3\">\r\n      <slot name=\"title\">Title</slot>\r\n    </p>\r\n    <p class=\"is-size-4\">\r\n      <slot name=\"subtitle\">Subtitle</slot>\r\n    </p>\r\n  </div>\r\n</div>\r\n",
    "<script>\r\n  export let baseYear;\r\n</script>\r\n\r\n<style>\r\n  .legend-title {\r\n    font-size: 14px;\r\n  }\r\n\r\n  .legend-text {\r\n    font-size: 12px;\r\n  }\r\n\r\n  text {\r\n    fill: hsl(0, 0%, 29%);\r\n  }\r\n\r\n  div {\r\n    width: 300px;\r\n  }\r\n</style>\r\n\r\n<div>\r\n  <svg\r\n    version=\"1.1\"\r\n    id=\"Layer_1\"\r\n    xmlns=\"http://www.w3.org/2000/svg\"\r\n    xmlns:xlink=\"http://www.w3.org/1999/xlink\"\r\n    x=\"0px\"\r\n    y=\"0px\"\r\n    viewBox=\"0 0 320 45.3\"\r\n    style=\"enable-background:new 0 0 320 45.3;\"\r\n    xml:space=\"preserve\">\r\n\r\n    <g transform=\"translate(0,20)\">\r\n\r\n      <image\r\n        style=\"overflow:visible;enable-background:new ;\"\r\n        width=\"256\"\r\n        height=\"1\"\r\n        xlink:href=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAABCAYAAAAxWXB3AAADkklEQVQ4jQXBDVCPdwDAcbfdbk+p\r\n        FKolZIzlOl1aTCxvDWNxrHkba6wtr+lqZE3X6v4XIfKycBFasnQpJalUkvT+4r9a76UXvb+/v/x/\r\n        z/Pd5zPl0BRdTnygx6kPp+H9kT6qjw04LxkQpD2d4KkzCNGZyX09QyKmGfFI34gYA2Pip39C4gwT\r\n        UgxnkWZkyitjU7JMZpNrOoeCOXMpNjND/ek8yhbMp2LRAqrNP6POYiENlp/TtNScli8W07bcgg7b\r\n        JXTZWdKz1opee2v6N9owsHk5gw4rGNq+kmHHrxjZtZrRvWsZ27+esZ++ZvznTUz8upmJw98ycWwr\r\n        kye2M+n+HZO/7UTjuRuN1140Z/aj8XFC43sQjcoZ4e+CCDiMuHAUEeiKCHJDXPVAXD+JuHEaccsL\r\n        EeKNCPVB3PNDhKkQ4WcREQGIyIuIqEuI6CuImGuIJ8GI+JuIhBBE4h1E0l1EShgiNRyR/hCREYmc\r\n        GYX8+jHym1jknDjkvATk/ETkwiTk4hTkklRkdTpyaQZyWSZyeRZKRTZKZS5KdT5KTSFKbTFKfQnK\r\n        OzVKQylKYxlKUzlKcwVKSxVKazVKWy1Kex1KRz1KZwNKZyN0NUH3e+hpgd5W6GuD/nYY6ISBLhjs\r\n        hqEeGO6FkT5GJ2FoXKF/VKZnRNA5pKF9YJKW/gmae8dp6B6nvmuMmo5RqtpGKG8dpuz9MOrmIUoa\r\n        BylsGCC/vp+cuj6yanrJrO7hZVU3qRVdJJd3kljWQXxpO7HqNqLftvKouIWIovf8XdDM3bwmbuc2\r\n        cjO7gb+y3nEls55LGfWcT6/jbFotqhc1/JlcjffzKryeVXLqaSUecRW4xZZzPOY/jkSX4RJVinPk\r\n        vxx4qMbpwVv2hZewJ6yYXfeKcAwtYsedQraFFOBwK58tN/L4JjiXDddzsL+azbqgN6y5nIVd4GtW\r\n        XcjENuAVX57LYJn/S2xU6Vj7pWHlm4qlzwuWeKdgcSaZxV5JmJ9+ziLPRBaefMYCjwTmuz9lnls8\r\n        Zq5xzD3+hNlHYzE9EsOsQ48xcYnG+JcojJwfYXgwkpkH/mGGUwTTf3yAwb5w9H8IQ3/Pfabtvove\r\n        zlB0v7+NrmMIOjtuobP9JlO3BTN163W0Ha6hveUK2psvo70pEK2NF9HacB4t+3NorfdHa50KaY0f\r\n        0mpfJDsfpFXeSCv/QLL9HWmFJ9Lyk0jLPJBs3JGs3ZCWuiJZHeN/8xLJWVweskkAAAAASUVORK5C\r\n        YII=\"\r\n        transform=\"matrix(1.25 0 0 13 0 -1.9714)\" />\r\n      <g transform=\"translate(160.5,0)\">\r\n        <text class=\"legend-text\" transform=\"matrix(1 0 0 1 -30.8356 21.1285)\">\r\n          No Change\r\n        </text>\r\n      </g>\r\n      <text class=\"legend-title\" transform=\"matrix(1 0 0 1 0 -7.9714)\">\r\n        Change Compared to {baseYear}\r\n      </text>\r\n    </g>\r\n    <text class=\"legend-text\" transform=\"matrix(1 0 0 1 265.9746 40.8997)\">\r\n      Increase\r\n    </text>\r\n    <text class=\"legend-text\" transform=\"matrix(1 0 0 1 8 41.3568)\">\r\n      Decrease\r\n    </text>\r\n  </svg>\r\n</div>\r\n",
    "<script>\r\n  import {\r\n    group,\r\n    groups,\r\n    extent,\r\n    ascending,\r\n    least,\r\n    max,\r\n    min,\r\n    permute,\r\n    mean\r\n  } from \"d3-array\";\r\n  import options from \"./data/options.js\";\r\n  import { fontColor, throttle, numberFormat } from \"./utilities.js\";\r\n  import \"array-flat-polyfill\";\r\n  import { onMount, onDestroy, createEventDispatcher } from \"svelte\";\r\n\r\n  const dispatch = createEventDispatcher();\r\n\r\n  const locationNamesMap = new Map(\r\n    options.get(\"location\").options.map(d => [d.value, d.label])\r\n  );\r\n  const numberPerPage = 10;\r\n\r\n  export let data;\r\n  export let projectionStartYear;\r\n  export let showTitle = true;\r\n  export let currentYear;\r\n  export let baseYearOrder;\r\n  export let hovered;\r\n  export let hoveredColor;\r\n  export let colorScale = d => \"#fff\";\r\n\r\n  let leftCoord = 0;\r\n\r\n  $: frozenWidth =\r\n    params[\"locationType\"] == \"Medicaid Region\" ? \"13.5em\" : \"8em\";\r\n\r\n  let currentPage = 0;\r\n  //Reset counter when data changes\r\n  $: if (data) {\r\n    currentPage = 0;\r\n  }\r\n\r\n  //Why do Chrome and Edge appear to add a space after the locationType?\r\n  $: params = data.params\r\n    ? data.params.reduce((acc, curr) => {\r\n        acc[curr[0]] = options\r\n          .get(curr[0])\r\n          .options.find(d => d.value == curr[1]).label;\r\n        return acc;\r\n      }, {})\r\n    : {};\r\n\r\n  $: paramsMap = data.params\r\n    ? new Map(data.params.map(d => [d.name, d]))\r\n    : undefined;\r\n\r\n  $: currentNumberFormat = numberFormat(\r\n    +data.params.find(d => d[0] == \"rateOrTotal\")[1]\r\n  );\r\n\r\n  //Create Map for ordering based on baseYearOrder\r\n  $: groupedMap = group(data.values, d => d.location);\r\n\r\n  $: grouped = baseYearOrder\r\n    .map(d => groupedMap.get(d))\r\n    .map(function(d) {\r\n      return [\r\n        locationNamesMap.get(d[0].location),\r\n        d.sort((a, b) => ascending(a.year, b.year))\r\n      ];\r\n    });\r\n\r\n  $: calculateBackgroundColor = (index, cell) => {\r\n    return cell.year != currentYear\r\n      ? \"#ffffff\"\r\n      : hovered == cell.location\r\n      ? hoveredColor\r\n      : colorScale(cell.location);\r\n  };\r\n\r\n  $: numOfPages = Math.ceil(grouped.length / numberPerPage);\r\n  $: paged = group(grouped, (d, i) => Math.floor(i / numberPerPage));\r\n  $: currentRows = paged.get(currentPage);\r\n\r\n  function jumpToPage(e) {\r\n    currentPage = +e.target.innerText - 1;\r\n  }\r\n\r\n  function calculatePosition() {\r\n    const { left: containerLeft } = document\r\n      .getElementById(\"main-container\")\r\n      .getBoundingClientRect();\r\n    const { left: tableLeft } = document\r\n      .getElementById(\"top-level-table-div\")\r\n      .getBoundingClientRect();\r\n\r\n    leftCoord = tableLeft - containerLeft;\r\n  }\r\n\r\n  function handleLocationHover(id) {\r\n    dispatch(\"locationHover\", id);\r\n  }\r\n  function handleLocationLeave(id) {\r\n    dispatch(\"locationLeave\");\r\n  }\r\n\r\n  onMount(() => {\r\n    calculatePosition();\r\n    window.onresize = throttle(calculatePosition, 100);\r\n  });\r\n\r\n  onDestroy(() => {\r\n    window.onresize = null;\r\n  });\r\n</script>\r\n\r\n<style>\r\n  #wrapper {\r\n    overflow-x: scroll;\r\n    /* margin-left: 10em; */\r\n    overflow-y: visible;\r\n    padding: 0;\r\n  }\r\n\r\n  .frozen {\r\n    white-space: nowrap;\r\n    position: absolute;\r\n    /* width: 10em; */\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n  }\r\n\r\n  .projection {\r\n    border-top: 3px;\r\n    border-top-color: #6c7480;\r\n    border-top-style: solid;\r\n  }\r\n\r\n  .projection-header {\r\n    border-bottom-style: none;\r\n    font-size: 0.6em;\r\n  }\r\n\r\n  .number-cell {\r\n    text-align: right;\r\n  }\r\n</style>\r\n\r\n{#if data.values}\r\n  <div id=\"top-level-table-div\">\r\n    {#if showTitle}\r\n      <h1 class=\"title is-4\">\r\n        {params['type']}s by {params['locationType'].trim()}, North Carolina\r\n      </h1>\r\n      <h2 class=\"subtitle is-6\">\r\n        {permute(params, [\r\n          ...data.params.filter(d => d[0].includes('Scenario')).map(d => d[0]),\r\n          'setting',\r\n          'education',\r\n          'fteOrHeadcount',\r\n          'rateOrTotal',\r\n          'calculation'\r\n        ]).join(', ')}\r\n      </h2>\r\n    {/if}\r\n\r\n    <div\r\n      class=\"table-container\"\r\n      id=\"wrapper\"\r\n      style=\"margin-left:{frozenWidth};\">\r\n      <table class=\"table is-narrow\">\r\n        <thead>\r\n          <tr>\r\n            <th\r\n              class=\" frozen projection-header\"\r\n              style=\"width:{frozenWidth};\" />\r\n            {#each grouped[0][1] as year}\r\n              <th class=\"projection-header\" style=\"padding:0;\">\r\n                {year.year == projectionStartYear ? 'Projected' : ''}\r\n              </th>\r\n            {/each}\r\n          </tr>\r\n          <tr>\r\n            <th\r\n              class=\"frozen\"\r\n              style=\"left:{leftCoord}px;padding-bottom:5px;width:{frozenWidth};\">\r\n              {params['locationType']}\r\n            </th>\r\n            {#each grouped[0][1] as year}\r\n              <th class:projection={year.year >= projectionStartYear}>\r\n                {year.year}\r\n              </th>\r\n            {/each}\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {#each currentRows as row, index}\r\n            <tr>\r\n              <!-- This padding adjustment (along with the one in the thead) are to correct for some mysterious\r\n            misalignment of the borders for the first two elements in the first column. -->\r\n              <td\r\n                class=\"frozen\"\r\n                style=\"width:{frozenWidth};left:{leftCoord}px;{index == 0 ? `padding-bottom:5px;` : ''}\">\r\n                {row[0]}\r\n              </td>\r\n              {#each row[1] as cell, index}\r\n                <td\r\n                  class=\"number-cell\"\r\n                  style=\"background-color:{calculateBackgroundColor(index, cell)};\r\n                  color:{fontColor(calculateBackgroundColor(index, cell))};\"\r\n                  on:mouseenter={() => handleLocationHover(cell.location)}\r\n                  on:mouseleave={handleLocationLeave}>\r\n                  {currentNumberFormat(cell.value)}\r\n                </td>\r\n              {/each}\r\n            </tr>\r\n          {/each}\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n    {#if numOfPages > 1}\r\n      <nav class=\"pagination\" role=\"navigation\" aria-label=\"pagination\">\r\n        <ul class=\"pagination-list\">\r\n          {#each Array.from({ length: numOfPages }, (_, i) => i + 1) as pageNum}\r\n            <li>\r\n              <button\r\n                class=\"pagination-link {currentPage + 1 == pageNum ? 'is-current' : ''}\"\r\n                on:click={jumpToPage}\r\n                aria-label=\"Goto page {pageNum}\">\r\n                {pageNum}\r\n              </button>\r\n            </li>\r\n          {/each}\r\n        </ul>\r\n      </nav>\r\n    {/if}\r\n  </div>\r\n{:else}\r\n  <div class=\"notification\">\r\n    Choose a combination of selections and click \"Show\" to see a table of the\r\n    model's projections.\r\n  </div>\r\n{/if}\r\n",
    "<script>\r\n  import { scaleLinear, scaleBand } from \"d3-scale\";\r\n  import { format } from \"d3-format\";\r\n  import { createEventDispatcher } from \"svelte\";\r\n\r\n  const dispatch = createEventDispatcher();\r\n\r\n  export let mapYearDataArray;\r\n  export let valueExtentAllTime;\r\n  export let locationType;\r\n  export let hovered;\r\n  export let hoveredColor;\r\n  export let rateOrTotal;\r\n\r\n  $: margin = {\r\n    top: 30,\r\n    right: 10,\r\n    bottom: 10,\r\n    left: locationType == \"Medicaid Region\" ? 155 : 110\r\n  };\r\n  const width = 320;\r\n  $: height = mapYearDataArray.length * 20 + margin.top + margin.bottom;\r\n\r\n  $: x = scaleLinear()\r\n    .domain(valueExtentAllTime)\r\n    .range([margin.left, width - margin.right]);\r\n\r\n  $: y = scaleBand()\r\n    .domain(mapYearDataArray.map(d => d[0]))\r\n    .range([margin.top, height - margin.bottom])\r\n    .paddingInner(0.1);\r\n\r\n  const tickFormat = t => t.toLocaleString();\r\n\r\n  function handleLocationHover(id) {\r\n    dispatch(\"locationHover\", id);\r\n  }\r\n  function handleLocationLeave(id) {\r\n    dispatch(\"locationLeave\");\r\n  }\r\n</script>\r\n\r\n<style>\r\n  .yAxis {\r\n    text-anchor: end;\r\n  }\r\n\r\n  .anchor-middle {\r\n    text-anchor: middle;\r\n  }\r\n\r\n  svg text {\r\n    font-size: 12px;\r\n    fill: #363636;\r\n  }\r\n</style>\r\n\r\n<svg id=\"row-chart-svg\" viewBox=\"0 0 {width} {height}\">\r\n  <g>\r\n    <text\r\n      class=\"anchor-middle\"\r\n      transform=\"translate({margin.left + (width - margin.left - margin.right) / 2}\r\n      10)\">\r\n      {rateOrTotal}\r\n    </text>\r\n    <g>\r\n      {#each mapYearDataArray as bar}\r\n        <g transform=\"translate(0 {y(bar[0])})\">\r\n          <rect\r\n            width={Math.abs(x(bar[1].value) - x(0))}\r\n            x={x(Math.min(bar[1].value, 0))}\r\n            height={y.bandwidth()}\r\n            fill={hovered == bar[0] ? hoveredColor : bar[1].fill}\r\n            stroke-width={hovered == bar[0] ? 3 : 0}\r\n            on:mouseenter={() => handleLocationHover(bar[0])}\r\n            on:mouseleave={handleLocationLeave}>\r\n            <title>{bar[1].name}: {bar[1].value}</title>\r\n          </rect>\r\n          <text\r\n            class=\"yAxis\"\r\n            transform=\"translate({margin.left})\"\r\n            dy=\"1em\"\r\n            dx=\"-3\">\r\n            {bar[1].name}\r\n          </text>\r\n        </g>\r\n      {/each}\r\n      <g transform=\"translate(0 {margin.top})\">\r\n        {#each x.ticks(5) as tick}\r\n          <g transform=\"translate({x(tick)} 0)\">\r\n            <line y1=\"0\" y2={height} stroke=\"#fff\" />\r\n            <text class=\"anchor-middle\" dy=\"-5\">{tickFormat(tick)}</text>\r\n          </g>\r\n        {/each}\r\n      </g>\r\n    </g>\r\n  </g>\r\n</svg>\r\n",
    "<script>\r\n  import { fade } from \"svelte/transition\";\r\n  export let name = \"Name\";\r\n  export let info = \"Information\";\r\n  let active = false;\r\n\r\n  function windowClicked(e) {\r\n    const classList = Array.from(e.target.classList);\r\n    if (!classList.includes(\"close-on-window-click\") & active) {\r\n      active = false;\r\n    }\r\n  }\r\n</script>\r\n\r\n<style>\r\n  .info-icon-wrapper {\r\n    display: inline-flex;\r\n  }\r\n\r\n  article {\r\n    left: 0px;\r\n    width: 300px;\r\n    position: absolute;\r\n    z-index: 100;\r\n  }\r\n\r\n  .icon-svg {\r\n    width: 16px;\r\n    height: 16px;\r\n  }\r\n</style>\r\n\r\n<svelte:window on:click|stopPropagation={windowClicked} />\r\n<div class=\"info-icon-wrapper \">\r\n  <svg\r\n    class=\"icon-svg has-fill-primary\"\r\n    on:click|stopPropagation={() => (active = true)}>\r\n    <use xlink:href=\"#fa-info-circle\" />\r\n  </svg>\r\n  {#if active}\r\n    <article\r\n      class=\"message is-small is-primary close-on-window-click\"\r\n      transition:fade>\r\n      <div class=\"message-header close-on-window-click\">\r\n        <p>{name}</p>\r\n        <button\r\n          class=\"delete\"\r\n          aria-label=\"delete\"\r\n          on:click|preventDefault|stopPropagation={() => (active = false)} />\r\n      </div>\r\n      <div class=\"message-body close-on-window-click\">{info}</div>\r\n    </article>\r\n  {/if}\r\n</div>\r\n"
  ],
  "names": [],
  "mappings": "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"
}